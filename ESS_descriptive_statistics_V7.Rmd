---
title: "Descriptive Statistics V7"
author: "Marei Göbelbecker & Helena Zappe"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, include=FALSE}
library(haven)
library(tidyverse)   
library(skimr)       
library(psych)       
library(rmarkdown)   
library(knitr)       
library(tinytex)     
library(dplyr)
library(here)
library(tidyr)
library(ggplot2)
```

```{r raw_data, include=FALSE}

# Load Raw Data

dt_new <- read_sav(here("data","ESS_lasso.sav")) 

```

`What shapes trust in the European Union and United Nations in Poland, Germany, and Slovenia? A comparative analysis of political attitudes, ideology, and socio-demographics.`

# General Overview (Lasso with 20 vars)

```{r}
# Summary statistics of all variables 

library(kableExtra)
#install.packages("kableExtra")

summary_stats <- dt_new %>%
  group_by(cntry) %>%
  summarise(across(
    where(is.numeric),
    list(
      mean = ~round(mean(.x, na.rm = TRUE), 2),
      sd = ~round(sd(.x, na.rm = TRUE), 2),
      median = ~round(median(.x, na.rm = TRUE), 2),
      Q5 = ~round(quantile(.x, 0.05, na.rm = TRUE), 2),
      Q95 = ~round(quantile(.x, 0.95, na.rm = TRUE), 2)
    ),
    .names = "{.col}_{.fn}"
  )) %>%
  pivot_longer(-cntry, names_to = "variable_stat", values_to = "value") %>%
  separate(variable_stat, into = c("variable", "stat"), sep = "_(?=[^_]+$)") %>%
  pivot_wider(names_from = stat, values_from = value) %>%
  arrange(cntry, variable)

summary_stats %>%
  kbl(caption = "Descriptive Statistics per Country",
      col.names = c("Country", "Variable", "Mean", "SD", "Median", "5. Percentile", "95. Percentile"),
      align = "l") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE,
                position = "left")

# Checking for NAs
colSums(is.na(dt_new))
```

Observations 65,237 Most Outliers: hmsacld 38,583; mmbprty 38,319; atcherp 38,407 (all about 58% missings)

*Difference to V6: polintr_rev, eduyrs, lrscale, stfdem & stfgov spielen keine Rolle bzw nicht genug, um nach Lasso noch bedeutend zu sein. Auch eine Erkenntniss, auch wenn das unsere ursprünglichen Predictors waren.*

# Variable Specifics

## Outcome Variable

-   **trstep**: Trust in EU

```{r}
dt_new %>%
  group_by(cntry) %>%
  summarise(across(trstep,
    list(mean = ~mean(.x, na.rm = TRUE),
         median = ~median(.x, na.rm = TRUE),
         Q5 = ~quantile(.x, 0.05, na.rm = TRUE),
         Q95 = ~quantile(.x, 0.95, na.rm = TRUE))
  ))

ggplot(dt_new, aes(x = cntry, y = trstep, fill = cntry)) +
  geom_boxplot() +
  labs(
    title = "Distribution of trstep by Country",
    x = "Country",
    y = "trstep (Trust in European Union)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

Mean Trust in EU is very similar between all countries (around 4.2). People in Germany are generally distributed closer around the mean.

## Political Attitudes

-   **euftf**: European Union: European unification go further or gone too far

```{r}
dt_new %>%
  group_by(cntry) %>%
  summarise(across(euftf,
    list(mean = ~mean(.x, na.rm = TRUE),
         median = ~median(.x, na.rm = TRUE),
         Q5 = ~quantile(.x, 0.05, na.rm = TRUE),
         Q95 = ~quantile(.x, 0.95, na.rm = TRUE))
  ))

# 0: unification already gone too far
# 10: unification go further

# Boxplot:
ggplot(dt_new, aes(x = cntry, y = euftf, fill = cntry)) +
  geom_boxplot() +
  labs(
    title = "Distribution of euftf by Country",
    x = "Country",
    y = "euftf (European unification go further or gone too far)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

# Violin Plot
ggplot(dt_new, aes(x = cntry, y = euftf, fill = cntry)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, outlier.shape = NA) +
  labs(
    title = "Distribution of EUFTF by Country",
    x = "Country",
    y = "EUFTF"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

On average, people are fairly neutral towards how far the unification should go (between 5.6 to 6, slightly above the median). Where people in Poland, on average, are highest in scale towards more unification.

*Outlier Löschen!*

-   **mmbprty**: Member of political party

```{r}
dt_new %>%
  group_by(cntry) %>%
  summarise(across(mmbprty,
    list(mean = ~mean(.x, na.rm = TRUE),
         median = ~median(.x, na.rm = TRUE),
         Q5 = ~quantile(.x, 0.05, na.rm = TRUE),
         Q95 = ~quantile(.x, 0.95, na.rm = TRUE))
  ))
# 1 - Yes
# 2 - No
```
Most people in all three countries are not part of a political party. 
*Therefore we can disregard this I guess bzw. warum sucht Lasso das dann aus? Ich schätze alle die auch Member sind, haben auch einen hohen Trust.*

-   **trstlgl**: Trust in the legal system

-   **trstplc**: Trust in the police

-   **trstplt**: Trust in politicians

-   **trstprl**: Trust in country's parliament

-   **trstprt**: Trust in political parties

```{r}
# Reshape to long format
dt_long <- dt_new %>%
  select(cntry, trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  pivot_longer(cols = -cntry, names_to = "variable", values_to = "trust")

# Plot
ggplot(dt_long, aes(x = variable, y = trust, fill = cntry)) +
  geom_boxplot(outlier.alpha = 0.3) +
  labs(
    title = "Distributions of Trust in Institutions by Country",
    x = "Institution",
    y = "Trust Level (0–10)",
    fill = "Country"
  ) +
  theme_minimal() +
  scale_x_discrete(
    labels = c(
      trstlgl = "Legal system",
      trstplc = "Police",
      trstplt = "Politicians",
      trstprl = "Parliament",
      trstprt = "Parties"
    )
  )
```

*Ich glaube Trust in Police kann man löschen.* *Generell finde ich die Übersicht eigentlich ganz schön auf dem Dashboard falls wir diese predictors verwenden.*

## Ideology

-   **hmsacld**: Gay and lesbian couples right to adopt children

-   **stfedu**: State of education in country nowadays

-   **impcntr**: Allow many/few immigrants from poorer countries outside Europe

-   **imueclt**: Country's cultural life undermined or enriched by immigrants

-   **imwbcnt**: Immigrants make country worse or better place to live

-   **atcherp**: How emotionally attached to Europe

## Socio-Demographics

-   **rlgatnd**: How often attend religious services apart from special occasions

## Mediators

-   **essround**

-   **cntry**

-   **gndr**

-   **age_group**

-   **year**

# Checking for Correlations

## General correlation matrix:

```{r}
dt_new %>%
  select(where(is.numeric)) %>%
  cor(use = "pairwise.complete.obs")
```

## Correlation Trust:

```{r}
# Correlation Matrix between trust vars

# No Country division
dt_new %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")

# Poland
dt_new %>%
  filter(cntry=="PL") %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")

# Germany
dt_new %>%
  filter(cntry=="DE") %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")

# Slovenia
dt_new %>%
  filter(cntry=="SI") %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")
```

Generally very high correlation -\> all min 0.4 to 0.8. Could be critical for overfitting.

Highest: trstprt x trstplt (0.8)

*Sollen wir Trust in Police rauswerfen? Ich sehe die Verbindung zu Trust in EU nicht.* *Wir müssen evtl einen Index machen oder zumindest ein paar rauswerfen.*

## Correlation Immigrants:

```{r}
# Correlation Matrix between trust vars

# No Country division
dt_new %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")

# Poland
dt_new %>%
  filter(cntry=="PL") %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")

# Germany
dt_new %>%
  filter(cntry=="DE") %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")

# Slovenia
dt_new %>%
  filter(cntry=="SI") %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")
```
