---
title: "Descriptive Statistics V7"
author: "Marei Göbelbecker & Helena Zappe"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, include=FALSE}
library(haven)
library(tidyverse)   
library(skimr)       
library(psych)       
library(rmarkdown)   
library(knitr)       
library(tinytex)     
library(dplyr)
library(here)
library(tidyr)
library(ggplot2)
```

```{r raw_data, include=FALSE}

# Load Raw Data

dt_new <- read_sav(here("data","ESS_lasso.sav")) 

```

`What shapes trust in the European Union and United Nations in Poland, Germany, and Slovenia? A comparative analysis of political attitudes, ideology, and socio-demographics.`

# General Overview (Lasso with 20 vars)

```{r}
# Summary statistics of all variables 

library(kableExtra)
#install.packages("kableExtra")

summary_stats <- dt_new %>%
  group_by(cntry) %>%
  summarise(across(
    where(is.numeric),
    list(
      mean = ~round(mean(.x, na.rm = TRUE), 2),
      sd = ~round(sd(.x, na.rm = TRUE), 2),
      median = ~round(median(.x, na.rm = TRUE), 2),
      Q5 = ~round(quantile(.x, 0.05, na.rm = TRUE), 2),
      Q95 = ~round(quantile(.x, 0.95, na.rm = TRUE), 2)
    ),
    .names = "{.col}_{.fn}"
  )) %>%
  pivot_longer(-cntry, names_to = "variable_stat", values_to = "value") %>%
  separate(variable_stat, into = c("variable", "stat"), sep = "_(?=[^_]+$)") %>%
  pivot_wider(names_from = stat, values_from = value) %>%
  arrange(cntry, variable)

summary_stats %>%
  kbl(caption = "Descriptive Statistics per Country",
      col.names = c("Country", "Variable", "Mean", "SD", "Median", "5. Percentile", "95. Percentile"),
      align = "l") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE,
                position = "left")

# Checking for NAs
colSums(is.na(dt_new))
```

Observations 65,237 Most Outliers: hmsacld 38,583; mmbprty 38,319; atcherp 38,407 (all about 58% missings)

*Difference to V6: polintr_rev, eduyrs, lrscale, stfdem & stfgov spielen keine Rolle bzw nicht genug, um nach Lasso noch bedeutend zu sein. Auch eine Erkenntniss, auch wenn das unsere ursprünglichen Predictors waren.*

# Variable Specifics

## Outcome Variable

-   **trstep**: Trust in EU

```{r trstep_over_time}

# Scale Prep
trstep_grouped <- dt_new %>%                      
  group_by(cntry, essround) %>%
  summarise(
    trust_EU = mean(trstep, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(year = case_when(    # Mapping ESS round to the year they were conducted in in "year"
    essround == 1 ~ 2002,
    essround == 2 ~ 2004,
    essround == 3 ~ 2006,
    essround == 4 ~ 2008,
    essround == 5 ~ 2010,
    essround == 6 ~ 2012,
    essround == 7 ~ 2014,
    essround == 8 ~ 2016,
    essround == 9 ~ 2018,
    essround == 10 ~ 2020,
    essround == 11 ~ 2022,
    TRUE ~ NA_real_
  ))

#Reshaping to long format for plotting
trust_long <- trstep_grouped %>%
  pivot_longer(cols = c(trust_EU),
               names_to = "institution",
               values_to = "trust")

# Line Plot divided by years
ggplot(trstep_grouped, aes(x = year, y = trust_EU, color = cntry)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_color_manual(
    values = c(
      "DE" = "#33658a",  # Germany
      "PL" = "#f6ae2d",  # Poland
      "SI" = "#f26419"   # Slovenia
    ),
    labels = c("DE" = "Germany", "PL" = "Poland", "SI" = "Slovenia")
  ) +
  labs(
    title = "Trust in the EU Over Time",
    x = "Year",
    y = "Mean Trust in EU",
    color = "Country"
  ) +
  theme_minimal()

# Summary Statistic across all years
dt_new %>%
  group_by(cntry) %>%
  summarise(across(trstep,
    list(mean = ~mean(.x, na.rm = TRUE),
         median = ~median(.x, na.rm = TRUE),
         Q5 = ~quantile(.x, 0.05, na.rm = TRUE),
         Q95 = ~quantile(.x, 0.95, na.rm = TRUE))
  ))

```

-   Mean trust in Slovenia peaked in 2006 and was the lowest in 2014.
-   Mean trust in Poland peaked in 2002 and was the lowest in 2014.
-   Mean trust in Germany peaked in 2023 and was the lowest in 2010.

**Plot 1 -- Trust in EU over Time**

## Political Attitudes

-   **euftf**: European Union: European unification go further or gone too far

```{r}
dt_new %>%
  group_by(cntry) %>%
  summarise(across(euftf,
    list(mean = ~mean(.x, na.rm = TRUE),
         median = ~median(.x, na.rm = TRUE),
         Q5 = ~quantile(.x, 0.05, na.rm = TRUE),
         Q95 = ~quantile(.x, 0.95, na.rm = TRUE))
  ))

# 0: unification already gone too far
# 10: unification go further

# Boxplot:
ggplot(dt_new, aes(x = cntry, y = euftf, fill = cntry)) +
  geom_boxplot() +
  labs(
    title = "Distribution of euftf by Country",
    x = "Country",
    y = "euftf (European unification go further or gone too far)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

# Violin Plot
ggplot(dt_new, aes(x = cntry, y = euftf, fill = cntry)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, outlier.shape = NA) +
  labs(
    title = "Distribution of EUFTF by Country",
    x = "Country",
    y = "EUFTF"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

On average, people are fairly neutral towards how far the unification should go (between 5.6 to 6, slightly above the median). Where people in Poland, on average, are highest in scale towards more unification.

*Outlier Löschen!*

-   **mmbprty**: Member of political party

```{r}
dt_new %>%
  group_by(cntry) %>%
  summarise(across(mmbprty,
    list(mean = ~mean(.x, na.rm = TRUE),
         median = ~median(.x, na.rm = TRUE),
         Q5 = ~quantile(.x, 0.05, na.rm = TRUE),
         Q95 = ~quantile(.x, 0.95, na.rm = TRUE))
  ))
# 1 - Yes
# 2 - No
```
Most people in all three countries are not part of a political party. 
*Therefore we can disregard this I guess bzw. warum sucht Lasso das dann aus? Ich schätze alle die auch Member sind, haben auch einen hohen Trust.*

-   **trstlgl**: Trust in the legal system

-   **trstplc**: Trust in the police

-   **trstplt**: Trust in politicians

-   **trstprl**: Trust in country's parliament

-   **trstprt**: Trust in political parties

```{r}
# Reshape to long format
dt_long <- dt_new %>%
  select(cntry, trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  pivot_longer(cols = -cntry, names_to = "variable", values_to = "trust")

# Plot
ggplot(dt_long, aes(x = variable, y = trust, fill = cntry)) +
  geom_boxplot(outlier.alpha = 0.3) +
  labs(
    title = "Distributions of Trust in Institutions by Country",
    x = "Institution",
    y = "Trust Level (0–10)",
    fill = "Country"
  ) +
  theme_minimal() +
  scale_x_discrete(
    labels = c(
      trstlgl = "Legal system",
      trstplc = "Police",
      trstplt = "Politicians",
      trstprl = "Parliament",
      trstprt = "Parties"
    )
  )
```

*Ich glaube Trust in Police, in Political Parties und das Legal System kann man löschen.* 

## Ideology

-   **atcherp**: How emotionally attached to Europe

-   **hmsacld**: Gay and lesbian couples right to adopt children

-   **impcntr**: Allow many/few immigrants from poorer countries outside Europe

```{r}
dt_new %>%
  group_by(cntry) %>%
  summarise(across(impcntr,
    list(mean = ~mean(.x, na.rm = TRUE),
         median = ~median(.x, na.rm = TRUE),
         Q5 = ~quantile(.x, 0.05, na.rm = TRUE),
         Q95 = ~quantile(.x, 0.95, na.rm = TRUE))
  ))

# 1 - Allow many to come and live here
# 4 - Allow none
```

-   **imueclt**: Country's cultural life undermined or enriched by immigrants

-   **imwbcnt**: Immigrants make country worse or better place to live



## Socio-Demographics

-   **rlgatnd**: How often attend religious services apart from special occasions

-   **stfedu**: State of education in country nowadays

## Mediators

-   **essround**

-   **cntry**

-   **gndr**

-   **age_group**

```{r distr_age_in_cntry}

dt_new %>%
  count(cntry, age_group) %>%
  group_by(cntry) %>%
  mutate(prop = n / sum(n) * 100) %>%
  ggplot(aes(x = cntry, y = prop, fill = age_group)) +
  geom_col(position = "dodge") +
  labs(
    title = "Relative Distribution of Age Groups by Country",
    x = "Country",
    y = "Proportion of Respondents",
    fill = "Age Group"
  ) +
  theme_minimal()

```

-   Among all countries, the age group "65+" has the highest share.
-   Age distribution has an upward trend in all three countries, indicating an aging population.

-   **year**

## Variables across years and countries

- **Average Trust in EU by Age Group and Country**

```{r trstep_by_age_in_cntry}
dt_new %>%
  group_by(cntry, age_group) %>%
  summarise(mean_trustEU = mean(trstep, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = age_group, y = mean_trustEU, fill = cntry)) +
  geom_col(position = "dodge") +
  scale_fill_manual(
    values = c(
      "DE" = "#33658a",     # Germany - Blue
      "PL" = "#f6ae2d",     # Poland - Light Orange
      "SI" = "#f26419"      # Slovenia - Dark Orange/Pink
    ),
    labels = c(
      "DE" = "Germany",
      "PL" = "Poland",
      "SI" = "Slovenia"
    )
  ) +
  labs(
    title = "Average Trust in EU by Age Group and Country",
    x = "Age Group",
    y = "Mean Trust in EU",
    fill = "Country"
  ) +
  theme_minimal()

```

-   Highest mean trust in EU among people younger than 18 in all three countries, with respondents from Germany having the highest trust.
-   General downward trend in meant trust in EU across all countries up to the age group 55-64.
-   Trust increases again for respondents being 65 or older.

- **Average Trust in Politicians by Age Group and Country**

```{r trstpol_by_age_in_cntry}
dt_new %>%
  group_by(cntry, age_group) %>%
  summarise(mean_trustpol = mean(polintr_rev, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = age_group, y = mean_trustpol, fill = cntry)) +
  geom_col(position = "dodge") +
  scale_fill_manual(
    values = c(
      "DE" = "#33658a",     # Germany - Blue
      "PL" = "#f6ae2d",     # Poland - Light Orange
      "SI" = "#f26419"      # Slovenia - Dark Orange/Pink
    ),
    labels = c(
      "DE" = "Germany",
      "PL" = "Poland",
      "SI" = "Slovenia"
    )
  ) +
  labs(
    title = "Average Trust in Politicians by Age Group and Country",
    x = "Age Group",
    y = "Mean Trust in Politicians",
    fill = "Country"
  ) +
  theme_minimal()
```

-   clearly highest trust in politicians in Germany among all age groups.
-   Polish respondents seem to have higher trust than Slovenian respondents in all age group, except for the groups 55-64 and 65+.

# Checking for Correlations

## General correlation matrix:

```{r}
dt_new %>%
  select(where(is.numeric)) %>%
  cor(use = "pairwise.complete.obs")
```

## Correlation Trust:

```{r}
# Correlation Matrix between trust vars

# No Country division
dt_new %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")

# Poland
dt_new %>%
  filter(cntry=="PL") %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")

# Germany
dt_new %>%
  filter(cntry=="DE") %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")

# Slovenia
dt_new %>%
  filter(cntry=="SI") %>%
  select(trstlgl, trstplc, trstplt, trstprl, trstprt) %>%
  cor(use = "pairwise.complete.obs")
```

Generally very high correlation -\> all min 0.4 to 0.8. Could be critical for overfitting.

Highest: trstprt x trstplt (0.8)

*Sollen wir Trust in Police rauswerfen? Ich sehe die Verbindung zu Trust in EU nicht.* *Wir müssen evtl einen Index machen oder zumindest ein paar rauswerfen.*

## Correlation Immigrants:

```{r}
# Correlation Matrix between trust vars

# No Country division
dt_new %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")

# Poland
dt_new %>%
  filter(cntry=="PL") %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")

# Germany
dt_new %>%
  filter(cntry=="DE") %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")

# Slovenia
dt_new %>%
  filter(cntry=="SI") %>%
  select(impcntr, imueclt, imwbcnt) %>%
  cor(use = "pairwise.complete.obs")
```

